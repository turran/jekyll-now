---
layout: post
title: Glamo Xrender Benchmark with Expedite
date: '2009-03-03T10:51:00.010+01:00'
author: turran
tags:
- openmoko
- efl
modified_time: '2009-03-04T00:09:31.678+01:00'
blogger_id: tag:blogger.com,1999:blog-4245000852706595379.post-7904541954899473658
blogger_orig_url: http://www.turran.org/2009/03/glamo-xrender-benchmark-with-expedite.html
---

Yesterday I've been testing the xrender engine on evas using the current EXA acceleration found in glamo (that is: solid fills and surface blitting). Sadly the test was taking ages to finish and even after walking up and leaving it the whole night it didnt finish but hang on the text test.

So, i wanted to test just the glue found on XRender and the implementation of it using EXA, but without painting anything, just memory moves from system memory to VRAM and the neccesary logic found on the Evas' Xrender engine. So I "removed" (just return TRUE) the functions from the xf86-video-glamo driver and .... here are the results:

<table><tr><td>Benchmark</td><td>Software X11</td><td>XRender without painting</td></tr><tr><td>Image Blend Unscaled</td><td>2.76</td><td>????</td></tr><tr><td>Image Blend Solid Unscaled</td><td>12.69</td><td style="background-color: green">13.72</td></tr><tr><td>Image Blend Nearest Scaled</td><td>1.56</td><td style="background-color: green">18.14</td></tr><tr><td>Image Blend Nearest Solid Scaled</td><td>8.77</td><td style="background-color: green">18.00</td></tr><br /><tr><td>Image Blend Smooth Scaled</td><td>0.45</td><td style="background-color: green">18.22</td><br /></tr><tr><td>Image Blend Smooth Solid Scaled</td><td>5.93</td><td style="background-color: green">17.59</td></tr><tr><td>Image Blend Nearest Same Scaled</td><td>5.02</td><td style="background-color: green">21.26</td></tr><tr><td>Image Blend Nearest Solid Same Scaled</td> <td style="background-color: green">22.05</td><td>17.73</td></tr><tr><td>Image Blend Smooth Same Scaled</td><td>1.27</td><td style="background-color: green">20.96</td></tr><tr><td>Image Blend Smooth Solid Same Scaled</td><td>11.84</td><td style="background-color: green">17.76</td></tr><tr><br /> <td>Image Blend Border</td><td>0.51</td><td style="background-color: green">1.83</td></tr><tr><td>Image Blend Solid Border</td><td style="background-color: green">6.67</td><td>1.97</td></tr><tr><td>Image Blend Border Recolor</td><td>0.44</td><td style="background-color: green">1.23</td></tr><tr><td>Image Quality Scale</td><td style="background-color: green">4.29</td><br /> <td>1.97</td></tr><tr><td>Image Data ARGB</td><td style="background-color: green">7.22</td><td>3.71</td></tr><tr><td>Image Data ARGB Alpha</td><td style="background-color: green">4.89</td> <td>1.70</td></tr><tr><td>Image Data YCbCr 601 Pointer List</td><td style="background-color: green">6.54</td><td>3.16</td></tr><tr><td>Image Data YCbCr 601 Pointer List Wide Stride</td><td style="background-color: green">6.04</td><td>5.40</td></tr><tr><td>Image Crossfade</td><td style="background-color: green">6.67</td><td>4.61</td></tr><tr><td>Text Basic</td><td style="background-color: green">9.28</td><td>2.25</td></tr><tr><td>Text Styles</td><td style="background-color: green">1.05</td><td>0.17</td></tr><tr><td>Text Styles Different Strings</td><td style="background-color: green">0.79</td><td>0.14</td></tr><tr><td>Text Change</td><td style="background-color: green">5.64</td><td>1.86</td></tr><tr><td>Textblock Basic</td><td style="background-color: green">5.67</td><td>1.50</td></tr><tr><td>Textblock Intl</td><td style="background-color: green">4.67</td><td>2.46</td></tr><tr><td>Rect Blend</td><br /><td>1.81</td><td style="background-color: green">9.66</td></tr><tr><td>Rect Solid</td><td>9.57</td><td style="background-color: green">18.02</td></tr><tr><td>Rect Blend Few</td><td>69.84</td><td>?????</td></tr><tr><td>Rect Solid Few</td><td style="background-color: green">84.22</td><td>61.79</td></tr><tr><td>Image Blend Occlude 1 Few</td><td>41.09</td><td style="background-color: green">196.75</td></tr><tr><td>Image Blend Occlude 2 Few</td><td>24.00</td><td style="background-color: green">47.37</td></tr><tr><td>Image Blend Occlude 3 Few</td><td>17.50</td><td style="background-color: green">70.32</td></tr><tr><td>Image Blend Occlude 1</td><td style="background-color: green">43.26</td><td>26.20</td></tr><tr><td>Image Blend Occlude 2</td><td style="background-color: green">14.59</td><td>14.03</td></tr><tr><td>Image Blend Occlude 3</td><td>4.87</td><td style="background-color: green">21.06</td> <br /></tr><tr><td>Image Blend Occlude 1 Many</td><td style="background-color: green">27.31</td><td>12.14</td></tr><tr><td>Image Blend Occlude 2 Many</td><td style="background-color: green">6.81</td><td>4.61</td></tr><tr><td>Image Blend Occlude 3 Many</td><td>2.21</td><td>????</td></tr><tr><td>Image Blend Occlude 1 Very Many</td><td style="background-color: green">3.79</td><td>1.54</td></tr><tr><td>Image Blend Occlude 2 Very Many</td><td style="background-color: green">0.66</td><td>0.43</td></tr><tr><td>Image Blend Occlude 3 Very Many</td><td>0.36</td><td style="background-color: green">0.58</td></tr><tr><td>Polygon Blend</td><br /><td style="background-color: green">3.51</td><td>1.69</td></tr><tr><td>EVAS SPEED</td><td>11.86</td><td style="background-color: green">18.66</td></tr></table>

The results are very disappointing, there are several places where drawing on software is better than just doing the logic on XRender/EXA to achieve the same result but without drawing. And in the tests where XRender/EXA is better the speed up doesn't worth as the drawing will be for sure slower. Note that the Glamo chip can only do raster operations into a destination surface of format RGB565, which means that there wont be any acceleration even if the blending is possible on hardware as Evas uses ARGB8888 premul.

Then, how to improve the speed of the rendering on Evas specifically for this chip? The path through XRender/EXA is worthless, is there any other way? Well. one possibility we could use, is to use the Evas' software_16 engine (a destination surface of format RGB565) to reduce the bandwidth needed, but how to match that with the XRender API?

Another solution could be to leave the efforts on xf86-video-glamo acceleration and just build a specific Evas engine for glamo. Mmap the whole framebuffer memory and manage it through Eina's memory pool manager, handle the surfaces ourselves and do a mix between software_16 and this specific engine. A lot of work, yes, but looks like the only solution (X away) that can give us some results. But there's a problem, how to send the changes into the displayed X window? because in our engine we'll use a VRAM backbuffer and we can't know from a X client the phyisical memory of the area the window is being drawn. So we'll have a roundtrip here, physical memory (our glamo surface) -> virtual memory (Xshm/X memory) -> physical memory (destination framebuffer), that for sure will remove any speedup.

Suggestions?
